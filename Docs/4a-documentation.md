Iteration 2 Plan
================

Basic Goals
-----------

*   The most important goal for this iteration is to clean up and integrate what we already have, and create a front end for it.
*   A few new features are being added as well, but integrating existing features will be prioritized.


Tests
-----

Our Python tests are in the `Tests` folder of our repository. Our Swift tests are in the `iOS` folder.

The relevant new tests are:

* Work Out
	* Tests for all workout-related driver.py functions have been added to testDriver.py. This test file
	has been adjusted to add a new user to the users table at the beginning and delete the user at the
	end, so it does not depend on any specific database state. As noted at the top of that file, the return
	value 0 means success, return value 1 means there was an error in accessing or updating the database,
	and return value 2 means an invalid action by the user.
	* Tests related to music recommendations have been added to testWorkout.py. A list of song recommendations
	will be retrieved for each exercise, given the bpm (beats per minute) of the exercise and the themes chosen
	by the user (if any), or themes we have extracted from the user's Spotify data and/or Spotify's workout playlists.
	To [get recommendations from the Spotify API](https://developer.spotify.com/web-api/get-recommendations/) we need
	between 1 and 5 themes, spread across genres, artists, and songs. We also need to have enough music at that bpm to play
	throughout the entire duration of the exercise.
	* We also made some additions to the tests for startWorkout in testUser.py. Now, when a user starts a workout,
	they will make progress on any goals that share the a category or muscle group with the started workout.
	Once the goal is completed, it is removed from the user's goals. 
* Fitness Test
	* Additional fitness test tests have been added to the bottom of `testFitnessTest.py` file, and marked as Iteration 2 tests.
* Goals, Themes, and Competitions
	* Tests for all goals, themes, and competitions related driver.py functions have been added to testDriver.py. The competitions tests are commented out, however, since the competitions feature is lower priority than the others. 		Functions for the easy representation of goals and themes (goalsSaved, themesSaved) have been added and tested as well.
	* As previously planned for iteration 2, the competitions class and relevant unit tests and integration with the user class have been added and tested (competition.py, testCompetition.py, testUser.py, user.py)
* Heart Rate Tests
	* Music-Driven-Workout-App/iOS/Music-Driven-Workout-App/Music-Driven-Workout-App/ViewController.swift

Higher priority implementation
------------------------------

### Infrastructure

*   Redoing User database and class (Lucy -- Milestone 4a)
*   Returning dictionaries from database queries -- (Lucy -- Milestone 4a)
*   Getting [Spotify access token](https://www.google.com/url?q=https://developer.spotify.com/web-api/authorization-guide/&sa=D&ust=1519334535014000&usg=AFQjCNGqFfJiDSSWEdY0BWoMqHAZHrztxQ) (Jessica and Julia -- can begin in Milestone 4a)
*   Add competitions database (Jessica and Julia -- only if we finish everything else)

### Front End

*   iOS front end for all use cases, beginning with those fully implemented in Iteration 1 (Chris and Alex -- begin in Milestone 4a)
*   Collecting heart rate data and determining if they’re within their target heart rate range for cardio workouts (Gregory)


### Work Out
* Create a function to map rpm of an exercise to bpm of a song. We will determine a range of bpm for each exercise category and pull a multiple of the rpm from this range to use as bpm. (Manasvi)
* Use the exercise bpm and the user's input themes (if any), or themes extracted from the user's Spotify data
 and/or Spotify's workout playlists to get artists, tracks and/or genres to input into the Spotify SDK and get recommended music generated by Spotify. This music should have the correct tempo and be in line with user preference.  We will first check if they have a theme set to get artists, tracks and/or genres. If they do not, we will check if they have a workout playlist and pull these from there. If they do not have a workout playlist, we will pull from a random workout playlist on Spotify. (Larissa and Manasvi)
* We will be interacting with the Spotify API via the [spotipy python package](https://github.com/plamere/spotipy).
* Work with the front end team on playback via the Spotify iOS SDK of track uri's returned in the workout. (Larissa and Manasvi)

### Fitness Test

*   Improve motion data processing algorithm to get more accurate frequency (Gregory)
*	Adjust fitness test route to account for options and saving to database (Gregory)
*   Route for previous trials (Lucy - Milestone 4a)
*   “Add exercise” option -- variation of the fitness test where they add the exercise at the exact pace they want to do it at (Lucy)
*   Getting desired rpm for an exercise (Lucy)
*   Getting level by number of fitness tests completed (Lucy)

### Goals, Themes, Competitions (Jessica and Julia)

*   Spotify SDK
*   Collecting information on which of the user's top Spotify songs/artists/genres they want to work out to for suggesting themes
*   Integrating goals and themes with workouts

Lower priority
--------------

*   Making a separate database for competitions
*   Integrating competitions with the user experience
*   Accept muscle groups and equipment for choosing the fitness test (Lucy)

Database Changes
----------------

### Users table

We have made the following changes to the `users` table in our database, and we have made the consequent changes to the User class, tests, and `getUser` function in `driver.py`

| Column             | Type        | Change              |
| ------------------ |------------ | --------------------|
| id                 | INTEGER     | INTEGER PRIMARY KEY |
| name               | VCHAR(50)   | \[remove\]          |
| spotifyUsername    | VCHAR(50)   | \[add\]             |
| height             | INT         | \[add\]             |
| weight             | INT         | \[add\]             |
| birthyear          | YEAR        | \[add\]             |
| tracked            | VCHAR(9999) | \[remove\]          |
| untracked          | VCHAR(9999) | \[remove\]          |
| goals              | VCHAR(9999) |                     |
| themes             | VCHAR(9999) |                     |
| competition        | VCHAR(9999) | INT FOREIGN KEY REF |
| inProgressWorkouts | VCHAR(9999) |                     |
| savedWorkouts      | VCHAR(9999) |                     |

### UserExercises table

We have added a column for whether a `userexercise` is intended to be interpreted as the exact time a user wants to work out at (from the new Add Exercise feature) or as a fitness test, which is done more quickly than the user may want to work out at.

### Competitions table

If the goals/themes/competitions group has time to implement competitions, they will make a new table with the following rows. This is a lower priority, however, and this group will focus first on helping out with getting the Spotify SDK set up, and doing themes and goals.

| Column              | Type                 |
| ------------------- | -------------------- |
| id                  | INT PRIMARY KEY      |
| name                | VCHAR(50)            |
| description         | VCHAR(50)            |
| members             | INT FOREIGN KEY REFS |
| admins              | INT FOREIGN KEY REFS |
| startDate           | DATE                 |
| endDate             | DATE                 |
| exercises           | INT FOREIGN KEY REFS |
| Winner (maybe)      | INT FOREIGN KEY REF  |
